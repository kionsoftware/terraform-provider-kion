---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "kion_azure_account Resource - terraform-provider-kion"
subcategory: ""
description: |-
  Creates or imports an Azure Subscription and adds it to a Kion project or the Kion account cache.
  If subscription_uuid is provided, an existing subscription will be imported into Kion, otherwise a new Azure subscription will be created.  If project_id is provided the account will be added to the corresponding project, otherwise the account will be added to the account cache.
  Once added, an account can be moved between projects or in and out of the account cache by changing the project_id.  When moving accounts between projects, use move_project_settings to control how financials will be treated between the old and new project.
  When importing an existing Kion account into terraform state (different from using terraform to import an existing Azure subscription into Kion), you must use the account_id= or account_cache_id= ID prefix to indicate whether the ID is an account ID or a cached account ID.
  For example:
  terraform import kion_azure_account.test-account account_id=123
  terraform import kion_azure_account.test-cached-account account_cache_id=321
  
  NOTE: This resource requires Kion v3.8.4 or greater.
---

# kion_azure_account (Resource)

Creates or imports an Azure Subscription and adds it to a Kion project or the Kion account cache.

If `subscription_uuid` is provided, an existing subscription will be imported into Kion, otherwise a new Azure subscription will be created.  If `project_id` is provided the account will be added to the corresponding project, otherwise the account will be added to the account cache.

Once added, an account can be moved between projects or in and out of the account cache by changing the `project_id`.  When moving accounts between projects, use `move_project_settings` to control how financials will be treated between the old and new project.

When importing an existing Kion account into terraform state (different from using terraform to import an existing Azure subscription into Kion), you must use the `account_id=` or `account_cache_id=` ID prefix to indicate whether the ID is an account ID or a cached account ID.

For example:

    terraform import kion_azure_account.test-account account_id=123
    terraform import kion_azure_account.test-cached-account account_cache_id=321

**NOTE:** This resource requires Kion v3.8.4 or greater.

## Example Usage

```terraform
# Example 1: Create a new Azure MCA subscription
resource "kion_azure_account" "mca_example" {
  # Required fields
  name              = "MCA Subscription Example"
  payer_id          = 1
  subscription_name = "terraform-mca-subscription"

  # MCA-specific configuration
  mca {
    billing_account         = "5e98e158-xxxx-xxxx-xxxx-xxxxxxxxxxxx:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx_xxxx-xx-xx"
    billing_profile         = "AW4F-xxxx-xxx-xxx"
    billing_profile_invoice = "SH3V-xxxx-xxx-xxx"
  }

  # Optional fields
  account_alias    = "mca-dev"
  account_type_id  = 2
  project_id       = 42  # Add to project instead of cache
  start_datecode   = "2024-03"  # Required when adding to project
}

# Example 2: Create a new Azure EA subscription
resource "kion_azure_account" "ea_example" {
  name              = "EA Subscription Example"
  payer_id          = 1
  subscription_name = "terraform-ea-subscription"

  # EA-specific configuration
  ea {
    account          = "12345678"
    billing_account  = "98765432"
  }

  # Optional: Place under specific management group
  parent_management_group_id = "mg-platform-prod"

  # Labels for organization
  labels = {
    environment = "production"
    department  = "engineering"
    cost_center = "12345"
  }
}

# Example 3: Create a new Azure CSP subscription
resource "kion_azure_account" "csp_example" {
  name              = "CSP Subscription Example"
  payer_id          = 1
  subscription_name = "terraform-csp-subscription"

  # CSP-specific configuration
  csp {
    offer_id       = "MS-AZR-0146P"
    billing_cycle  = "Monthly"  # Optional
  }

  # Optional configuration
  skip_access_checking = true
}

# Example 4: Import an existing Azure subscription
resource "kion_azure_account" "import_example" {
  name              = "Imported Subscription"
  payer_id          = 1
  subscription_uuid = "12345678-90ab-cdef-1234-567890abcdef"
  project_id        = 43
  start_datecode    = "2024-03"
}

# Example 5: Account with move project settings
resource "kion_azure_account" "movable_example" {
  name              = "Movable Subscription"
  payer_id          = 1
  subscription_name = "terraform-movable-sub"

  mca {
    billing_account         = "5e98e158-xxxx-xxxx-xxxx-xxxxxxxxxxxx:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx_xxxx-xx-xx"
    billing_profile         = "AW4F-xxxx-xxx-xxx"
    billing_profile_invoice = "SH3V-xxxx-xxx-xxx"
  }

  # Initial project placement
  project_id     = 44
  start_datecode = "2024-03"

  # Settings for when moving between projects
  move_project_settings {
    financials     = "move"  # or "preserve"
    move_datecode  = 202403  # Only move finances from March 2024 onwards
  }
}

# Output examples
output "mca_account_id" {
  description = "ID of the MCA subscription"
  value       = kion_azure_account.mca_example.id
}

output "ea_account_id" {
  description = "ID of the EA subscription"
  value       = kion_azure_account.ea_example.id
}

output "csp_account_id" {
  description = "ID of the CSP subscription"
  value       = kion_azure_account.csp_example.id
}

output "import_account_location" {
  description = "Location of the imported subscription (project or cache)"
  value       = kion_azure_account.import_example.location
}

output "account_creation_time" {
  description = "When the MCA subscription was created"
  value       = kion_azure_account.mca_example.created_at
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The name of the Azure account within Kion.
- `payer_id` (Number) The ID of the billing source containing billing data for this account.

### Optional

- `account_alias` (String) Account alias is an optional short unique name that helps identify the account within Kion.
- `account_type_id` (Number) An ID representing the account type within Kion.
- `csp` (Block Set, Max: 1) Parameters used when creating a new Azure CSP subscription. (see [below for nested schema](#nestedblock--csp))
- `ea` (Block Set, Max: 1) Parameters used when creating a new Azure EA subscription. (see [below for nested schema](#nestedblock--ea))
- `labels` (Map of String) A map of labels to assign to the account. The labels must already exist in Kion.
- `last_updated` (String)
- `mca` (Block Set, Max: 1) Parameters used when creating a new Azure MCA subscription. (see [below for nested schema](#nestedblock--mca))
- `move_project_settings` (Block Set, Max: 1) Parameters used when moving an account between Kion projects.  These settings are ignored unless moving an account. (see [below for nested schema](#nestedblock--move_project_settings))
- `parent_management_group_id` (String) The parent management group ID when creating an Azure subscription. If provided, the subscription will be created under the provided management group.  If not provided, the subscription will be created at the root level
- `project_id` (Number) The ID of the Kion project to place this account within.  If empty, the account will be placed within the account cache.
- `skip_access_checking` (Boolean) True to skip periodic access checking on the account.
- `start_datecode` (String) Date when the Azure account will starting submitting payments against a funding source (YYYY-MM).  Required if placing an account within a project.
- `subscription_name` (String) Name of the subscription as it appears in Azure.
- `subscription_uuid` (String) The UUID of the Azure subscription.  If subscription_uuid is provided, the existing subscription will be imported into Kion.  If subscription_uuid is omitted, a new subscription will be created.

### Read-Only

- `created_at` (String)
- `id` (String) The ID of this resource.
- `location` (String) Where the account is attached.  Either "project" or "cache".

<a id="nestedblock--csp"></a>
### Nested Schema for `csp`

Required:

- `offer_id` (String) Azure CSP offer id

Optional:

- `billing_cycle` (String) Azure CSP billing cycle


<a id="nestedblock--ea"></a>
### Nested Schema for `ea`

Required:

- `account` (String) Azure EA account number
- `billing_account` (String) Azure billing account number


<a id="nestedblock--mca"></a>
### Nested Schema for `mca`

Required:

- `billing_account` (String) Azure MCA billing account number
- `billing_profile` (String) Azure MCA billing profile number
- `billing_profile_invoice` (String) Azure MCA billing profile invoice section number


<a id="nestedblock--move_project_settings"></a>
### Nested Schema for `move_project_settings`

Optional:

- `financials` (String) One of "move" or "preserve".  If "move", financial history will be moved to the new project beginning on the date specified by the move_datecode parameter.  If "preserve", financial history will be preserved on the current project.
- `move_datecode` (Number) The start date to use when moving financial data in YYYYMM format.  This only applies when financials is set to move.  If provided, only financial data from this date to the current month will be moved to the new project.  If omitted or 0, all financial data will be moved to the new project.
